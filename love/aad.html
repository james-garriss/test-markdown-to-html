<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
  </head>
  <body><dark-mode style="position: fixed; top: 8px; left: 10px; z-index: 999;" dark="Dark" light="Light" permanent="true"></dark-mode><script>const t=document;const e="_dark_mode_theme_";const s="permanent";const o="colorschemechange";const i="permanentcolorscheme";const h="light";const r="dark";const n=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){const t=this.getAttribute(e);return t===null?"":t},set(t){this.setAttribute(e,t)}})};const c=(t,e,s=e)=>{Object.defineProperty(t,s,{enumerable:true,get(){return this.hasAttribute(e)},set(t){if(t){this.setAttribute(e,"")}else{this.removeAttribute(e)}}})};class a extends HTMLElement{static get observedAttributes(){return["mode",h,r,s]}LOCAL_NANE=e;constructor(){super();this.t()}connectedCallback(){n(this,"mode");n(this,r);n(this,h);c(this,s);const a=localStorage.getItem(e);if(a&&[h,r].includes(a)){this.mode=a;this.permanent=true}if(this.permanent&&!a){localStorage.setItem(e,this.mode)}const l=[h,r].includes(a);if(this.permanent&&a){this.o()}else{if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches){this.mode=r;this.o()}if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches){this.mode=h;this.o()}}if(!this.permanent&&!l){window.matchMedia("(prefers-color-scheme: light)").onchange=t=>{this.mode=t.matches?h:r;this.o()};window.matchMedia("(prefers-color-scheme: dark)").onchange=t=>{this.mode=t.matches?r:h;this.o()}}const d=new MutationObserver(((s,h)=>{this.mode=t.documentElement.dataset.colorMode;if(this.permanent&&l){localStorage.setItem(e,this.mode);this.i(i,{permanent:this.permanent})}this.h();this.i(o,{colorScheme:this.mode})}));d.observe(t.documentElement,{attributes:true});this.i(o,{colorScheme:this.mode});this.h()}attributeChangedCallback(t,s,o){if(t==="mode"&&s!==o&&[h,r].includes(o)){const t=localStorage.getItem(e);if(this.mode===t){this.mode=o;this.h();this.o()}else if(this.mode&&this.mode!==t){this.h();this.o()}}else if((t===h||t===r)&&s!==o){this.h()}if(t==="permanent"&&typeof this.permanent==="boolean"){this.permanent?localStorage.setItem(e,this.mode):localStorage.removeItem(e)}}o(){t.documentElement.setAttribute("data-color-mode",this.mode)}h(){this.icon.textContent=this.mode===h?"üåí":"üåû";this.text.textContent=this.mode===h?this.getAttribute(r):this.getAttribute(h)}t(){var s=this.attachShadow({mode:"open"});this.label=t.createElement("span");this.label.setAttribute("class","wrapper");this.label.onclick=()=>{this.mode=this.mode===h?r:h;if(this.permanent){localStorage.setItem(e,this.mode)}this.o();this.h()};s.appendChild(this.label);this.icon=t.createElement("span");this.label.appendChild(this.icon);this.text=t.createElement("span");this.label.appendChild(this.text);const o=`
[data-color-mode*='dark'], [data-color-mode*='dark'] body {
  color-scheme: dark;
  --color-theme-bg: #0d1117;
  --color-theme-text: #c9d1d9;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}

[data-color-mode*='light'], [data-color-mode*='light'] body {
  color-scheme: light;
  --color-theme-bg: #fff;
  --color-theme-text: #24292f;
  background-color: var(--color-theme-bg);
  color: var(--color-theme-text);
}`;const i="_dark_mode_style_";const n=t.getElementById(i);if(!n){var c=t.createElement("style");c.id=i;c.textContent=o;t.head.appendChild(c)}var a=t.createElement("style");a.textContent=`
    .wrapper { cursor: pointer; user-select: none; position: relative; }
    .wrapper > span + span { margin-left: .4rem; }
    `;s.appendChild(a)}i(t,e){this.dispatchEvent(new CustomEvent(t,{bubbles:true,composed:true,detail:e}))}}customElements.define("dark-mode",a);</script><script>const __TEMPLATE__ = document.createElement('template');
__TEMPLATE__.innerHTML = `
<style>

markdown-style h1:hover a.anchor .octicon-link:before,
markdown-style h2:hover a.anchor .octicon-link:before,
markdown-style h3:hover a.anchor .octicon-link:before,
markdown-style h4:hover a.anchor .octicon-link:before,
markdown-style h5:hover a.anchor .octicon-link:before,
markdown-style h6:hover a.anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
}
[data-color-mode*='light'], [data-color-mode*='light'] body, markdown-style[theme*='light'] { --color-prettylights-syntax-comment: #6e7781; --color-prettylights-syntax-constant: #0550ae; --color-prettylights-syntax-entity: #8250df; --color-prettylights-syntax-storage-modifier-import: #24292f; --color-prettylights-syntax-entity-tag: #116329; --color-prettylights-syntax-keyword: #cf222e; --color-prettylights-syntax-string: #0a3069; --color-prettylights-syntax-variable: #953800; --color-prettylights-syntax-brackethighlighter-unmatched: #82071e; --color-prettylights-syntax-invalid-illegal-text: #f6f8fa; --color-prettylights-syntax-invalid-illegal-bg: #82071e; --color-prettylights-syntax-carriage-return-text: #f6f8fa; --color-prettylights-syntax-carriage-return-bg: #cf222e; --color-prettylights-syntax-string-regexp: #116329; --color-prettylights-syntax-markup-list: #3b2300; --color-prettylights-syntax-markup-heading: #0550ae; --color-prettylights-syntax-markup-italic: #24292f; --color-prettylights-syntax-markup-bold: #24292f; --color-prettylights-syntax-markup-deleted-text: #82071e; --color-prettylights-syntax-markup-deleted-bg: #FFEBE9; --color-prettylights-syntax-markup-inserted-text: #116329; --color-prettylights-syntax-markup-inserted-bg: #dafbe1; --color-prettylights-syntax-markup-changed-text: #953800; --color-prettylights-syntax-markup-changed-bg: #ffd8b5; --color-prettylights-syntax-markup-ignored-text: #eaeef2; --color-prettylights-syntax-markup-ignored-bg: #0550ae; --color-prettylights-syntax-meta-diff-range: #8250df; --color-prettylights-syntax-brackethighlighter-angle: #57606a; --color-prettylights-syntax-sublimelinter-gutter-mark: #8c959f; --color-prettylights-syntax-constant-other-reference-link: #0a3069; --color-fg-default: #24292f; --color-fg-muted: #57606a; --color-fg-subtle: #6e7781; --color-canvas-default: #ffffff; --color-canvas-subtle: #f6f8fa; --color-border-default: #d0d7de; --color-border-muted: hsla(210,18%,87%,1); --color-neutral-muted: rgba(175,184,193,0.2); --color-accent-fg: #0969da; --color-accent-emphasis: #0969da; --color-attention-subtle: #fff8c5; --color-danger-fg: #cf222e; } [data-color-mode*='dark'], [data-color-mode*='dark'] body, markdown-style[theme*='dark'] { --color-prettylights-syntax-comment: #8b949e; --color-prettylights-syntax-constant: #79c0ff; --color-prettylights-syntax-entity: #d2a8ff; --color-prettylights-syntax-storage-modifier-import: #c9d1d9; --color-prettylights-syntax-entity-tag: #7ee787; --color-prettylights-syntax-keyword: #ff7b72; --color-prettylights-syntax-string: #a5d6ff; --color-prettylights-syntax-variable: #ffa657; --color-prettylights-syntax-brackethighlighter-unmatched: #f85149; --color-prettylights-syntax-invalid-illegal-text: #f0f6fc; --color-prettylights-syntax-invalid-illegal-bg: #8e1519; --color-prettylights-syntax-carriage-return-text: #f0f6fc; --color-prettylights-syntax-carriage-return-bg: #b62324; --color-prettylights-syntax-string-regexp: #7ee787; --color-prettylights-syntax-markup-list: #f2cc60; --color-prettylights-syntax-markup-heading: #1f6feb; --color-prettylights-syntax-markup-italic: #c9d1d9; --color-prettylights-syntax-markup-bold: #c9d1d9; --color-prettylights-syntax-markup-deleted-text: #ffdcd7; --color-prettylights-syntax-markup-deleted-bg: #67060c; --color-prettylights-syntax-markup-inserted-text: #aff5b4; --color-prettylights-syntax-markup-inserted-bg: #033a16; --color-prettylights-syntax-markup-changed-text: #ffdfb6; --color-prettylights-syntax-markup-changed-bg: #5a1e02; --color-prettylights-syntax-markup-ignored-text: #c9d1d9; --color-prettylights-syntax-markup-ignored-bg: #1158c7; --color-prettylights-syntax-meta-diff-range: #d2a8ff; --color-prettylights-syntax-brackethighlighter-angle: #8b949e; --color-prettylights-syntax-sublimelinter-gutter-mark: #484f58; --color-prettylights-syntax-constant-other-reference-link: #a5d6ff; --color-fg-default: #c9d1d9; --color-fg-muted: #8b949e; --color-fg-subtle: #484f58; --color-canvas-default: #0d1117; --color-canvas-subtle: #161b22; --color-border-default: #30363d; --color-border-muted: #21262d; --color-neutral-muted: rgba(110,118,129,0.4); --color-accent-fg: #58a6ff; --color-accent-emphasis: #1f6feb; --color-attention-subtle: rgba(187,128,9,0.15); --color-danger-fg: #f85149; } markdown-style { display: block; -webkit-text-size-adjust: 100%; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"; font-size: 16px; line-height: 1.5; word-wrap: break-word; color: var(--color-fg-default); background-color: var(--color-canvas-default); } markdown-style details, markdown-style figcaption, markdown-style figure { display: block; } markdown-style summary { display: list-item; } markdown-style [hidden] { display: none !important; } markdown-style a { background-color: transparent; color: var(--color-accent-fg); text-decoration: none; } markdown-style a:active, markdown-style a:hover { outline-width: 0; } markdown-style abbr[title] { border-bottom: none; text-decoration: underline dotted; } markdown-style b, markdown-style strong { font-weight: 600; } markdown-style dfn { font-style: italic; } markdown-style h1 { margin: .67em 0; font-weight: 600; padding-bottom: .3em; font-size: 2em; border-bottom: 1px solid var(--color-border-muted); } markdown-style mark { background-color: var(--color-attention-subtle); color: var(--color-text-primary); } markdown-style small { font-size: 90%; } markdown-style sub, markdown-style sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } markdown-style sub { bottom: -0.25em; } markdown-style sup { top: -0.5em; } markdown-style img { border-style: none; max-width: 100%; box-sizing: content-box; background-color: var(--color-canvas-default); } markdown-style code, markdown-style kbd, markdown-style pre, markdown-style samp { font-family: monospace,monospace; font-size: 1em; } markdown-style figure { margin: 1em 40px; } markdown-style hr { box-sizing: content-box; overflow: hidden; background: transparent; border-bottom: 1px solid var(--color-border-muted); height: .25em; padding: 0; margin: 24px 0; background-color: var(--color-border-default); border: 0; } markdown-style input { font: inherit; margin: 0; overflow: visible; font-family: inherit; font-size: inherit; line-height: inherit; } markdown-style [type=button], markdown-style [type=reset], markdown-style [type=submit] { -webkit-appearance: button; } markdown-style [type=button]::-moz-focus-inner, markdown-style [type=reset]::-moz-focus-inner, markdown-style [type=submit]::-moz-focus-inner { border-style: none; padding: 0; } markdown-style [type=button]:-moz-focusring, markdown-style [type=reset]:-moz-focusring, markdown-style [type=submit]:-moz-focusring { outline: 1px dotted ButtonText; } markdown-style [type=checkbox], markdown-style [type=radio] { box-sizing: border-box; padding: 0; } markdown-style [type=number]::-webkit-inner-spin-button, markdown-style [type=number]::-webkit-outer-spin-button { height: auto; } markdown-style [type=search] { -webkit-appearance: textfield; outline-offset: -2px; } markdown-style [type=search]::-webkit-search-cancel-button, markdown-style [type=search]::-webkit-search-decoration { -webkit-appearance: none; } markdown-style ::-webkit-input-placeholder { color: inherit; opacity: .54; } markdown-style ::-webkit-file-upload-button { -webkit-appearance: button; font: inherit; } markdown-style a:hover { text-decoration: underline; } markdown-style hr::before { display: table; content: ""; } markdown-style hr::after { display: table; clear: both; content: ""; } markdown-style table { border-spacing: 0; border-collapse: collapse; display: block; width: max-content; max-width: 100%; overflow: auto; } markdown-style td, markdown-style th { padding: 0; } markdown-style details summary { cursor: pointer; } markdown-style details:not([open])>*:not(summary) { display: none !important; } markdown-style kbd { display: inline-block; padding: 3px 5px; font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; line-height: 10px; color: var(--color-fg-default); vertical-align: middle; background-color: var(--color-canvas-subtle); border: solid 1px var(--color-neutral-muted); border-bottom-color: var(--color-neutral-muted); border-radius: 6px; box-shadow: inset 0 -1px 0 var(--color-neutral-muted); } markdown-style h1, markdown-style h2, markdown-style h3, markdown-style h4, markdown-style h5, markdown-style h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; } markdown-style h2 { font-weight: 600; padding-bottom: .3em; font-size: 1.5em; border-bottom: 1px solid var(--color-border-muted); } markdown-style h3 { font-weight: 600; font-size: 1.25em; } markdown-style h4 { font-weight: 600; font-size: 1em; } markdown-style h5 { font-weight: 600; font-size: .875em; } markdown-style h6 { font-weight: 600; font-size: .85em; color: var(--color-fg-muted); } markdown-style p { margin-top: 0; margin-bottom: 10px; } markdown-style blockquote { margin: 0; padding: 0 1em; color: var(--color-fg-muted); border-left: .25em solid var(--color-border-default); } markdown-style ul, markdown-style ol { margin-top: 0; margin-bottom: 0; padding-left: 2em; } markdown-style ol ol, markdown-style ul ol { list-style-type: lower-roman; } markdown-style ul ul ol, markdown-style ul ol ol, markdown-style ol ul ol, markdown-style ol ol ol { list-style-type: lower-alpha; } markdown-style dd { margin-left: 0; } markdown-style tt, markdown-style code { font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; } markdown-style pre { margin-top: 0; margin-bottom: 0; font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace; font-size: 12px; word-wrap: normal; } markdown-style .octicon { display: inline-block; overflow: visible !important; vertical-align: text-bottom; fill: currentColor; } markdown-style ::placeholder { color: var(--color-fg-subtle); opacity: 1; } markdown-style input::-webkit-outer-spin-button, markdown-style input::-webkit-inner-spin-button { margin: 0; -webkit-appearance: none; appearance: none; }
markdown-style .token.comment, markdown-style .token.prolog, markdown-style .token.doctype, markdown-style .token.cdata { color: var(--color-prettylights-syntax-comment); } markdown-style .token.namespace { opacity: 0.7; } markdown-style .token.tag, markdown-style .token.selector, markdown-style .token.constant, markdown-style .token.symbol, markdown-style .token.deleted { color: var(--color-prettylights-syntax-entity-tag); } markdown-style .token.maybe-class-name { color: var(--color-prettylights-syntax-variable); } markdown-style .token.property-access, markdown-style .token.operator, markdown-style .token.boolean, markdown-style .token.number, markdown-style .token.selector markdown-style .token.class, markdown-style .token.attr-name, markdown-style .token.string, markdown-style .token.char, markdown-style .token.builtin { color: var(--color-prettylights-syntax-constant); } markdown-style .token.deleted { color: var(--color-prettylights-syntax-markup-deleted-text); } markdown-style .token.property { color: var(--color-prettylights-syntax-constant); } markdown-style .token.punctuation { color: var(--color-prettylights-syntax-markup-bold); } markdown-style .token.function { color: var(--color-prettylights-syntax-entity); } markdown-style .code-line .token.deleted { background-color: var(--color-prettylights-syntax-markup-deleted-bg); } markdown-style .token.inserted { color: var(--color-prettylights-syntax-markup-inserted-text); } markdown-style .code-line .token.inserted { background-color: var(--color-prettylights-syntax-markup-inserted-bg); } markdown-style .token.variable { color: var(--color-prettylights-syntax-constant); } markdown-style .token.entity, markdown-style .token.url, .language-css markdown-style .token.string, .style markdown-style .token.string { color: var(--color-prettylights-syntax-string); } markdown-style .token.color, markdown-style .token.atrule, markdown-style .token.attr-value, markdown-style .token.function, markdown-style .token.class-name { color: var(--color-prettylights-syntax-string); } markdown-style .token.rule, markdown-style .token.regex, markdown-style .token.important, markdown-style .token.keyword { color: var(--color-prettylights-syntax-keyword); } markdown-style .token.coord { color: var(--color-prettylights-syntax-meta-diff-range); } markdown-style .token.important, markdown-style .token.bold { font-weight: bold; } markdown-style .token.italic { font-style: italic; } markdown-style .token.entity { cursor: help; }
markdown-style [data-catalyst] { display: block; } markdown-style g-emoji { font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"; font-size: 1em; font-style: normal !important; font-weight: 400; line-height: 1; vertical-align: -0.075em; } markdown-style g-emoji img { width: 1em; height: 1em; } markdown-style::before { display: table; content: ""; } markdown-style::after { display: table; clear: both; content: ""; } markdown-style>*:first-child { margin-top: 0 !important; } markdown-style>*:last-child { margin-bottom: 0 !important; } markdown-style a:not([href]) { color: inherit; text-decoration: none; } markdown-style .absent { color: var(--color-danger-fg); } markdown-style a.anchor { float: left; padding-right: 4px; margin-left: -20px; line-height: 1; } markdown-style a.anchor:focus { outline: none; } markdown-style p, markdown-style blockquote, markdown-style ul, markdown-style ol, markdown-style dl, markdown-style table, markdown-style pre, markdown-style details { margin-top: 0; margin-bottom: 16px; } markdown-style blockquote>:first-child { margin-top: 0; } markdown-style blockquote>:last-child { margin-bottom: 0; } markdown-style sup>a::before { content: "["; } markdown-style sup>a::after { content: "]"; }
markdown-style .octicon-video { border: 1px solid #d0d7de !important; border-radius: 6px !important; display: block; } markdown-style .octicon-video summary { border-bottom: 1px solid #d0d7de !important; padding: 8px 16px !important; cursor: pointer; } markdown-style .octicon-video > video { display: block !important; max-width: 100% !important; padding: 2px; box-sizing: border-box; border-bottom-right-radius: 6px !important; border-bottom-left-radius: 6px !important; } markdown-style details.octicon-video:not([open])>*:not(summary) { display: none !important; } markdown-style details.octicon-video:not([open]) > summary { border-bottom: 0 !important; } markdown-style h1 .octicon-link, markdown-style h2 .octicon-link, markdown-style h3 .octicon-link, markdown-style h4 .octicon-link, markdown-style h5 .octicon-link, markdown-style h6 .octicon-link { color: var(--color-fg-default); vertical-align: middle; visibility: hidden; } markdown-style h1:hover .anchor, markdown-style h2:hover .anchor, markdown-style h3:hover .anchor, markdown-style h4:hover .anchor, markdown-style h5:hover .anchor, markdown-style h6:hover .anchor { text-decoration: none; } markdown-style h1:hover .anchor .octicon-link, markdown-style h2:hover .anchor .octicon-link, markdown-style h3:hover .anchor .octicon-link, markdown-style h4:hover .anchor .octicon-link, markdown-style h5:hover .anchor .octicon-link, markdown-style h6:hover .anchor .octicon-link { visibility: visible; } markdown-style h1 tt, markdown-style h1 code, markdown-style h2 tt, markdown-style h2 code, markdown-style h3 tt, markdown-style h3 code, markdown-style h4 tt, markdown-style h4 code, markdown-style h5 tt, markdown-style h5 code, markdown-style h6 tt, markdown-style h6 code { padding: 0 .2em; font-size: inherit; } markdown-style ul.no-list, markdown-style ol.no-list { padding: 0; list-style-type: none; } markdown-style ol[type="1"] { list-style-type: decimal; } markdown-style ol[type=a] { list-style-type: lower-alpha; } markdown-style ol[type=i] { list-style-type: lower-roman; } markdown-style div>ol:not([type]) { list-style-type: decimal; } markdown-style ul ul, markdown-style ul ol, markdown-style ol ol, markdown-style ol ul { margin-top: 0; margin-bottom: 0; } markdown-style li>p { margin-top: 16px; } markdown-style li+li { margin-top: .25em; } markdown-style dl { padding: 0; } markdown-style dl dt { padding: 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: 600; } markdown-style dl dd { padding: 0 16px; margin-bottom: 16px; } markdown-style table th { font-weight: 600; } markdown-style table th, markdown-style table td { padding: 6px 13px; border: 1px solid var(--color-border-default); } markdown-style table tr { background-color: var(--color-canvas-default); border-top: 1px solid var(--color-border-muted); } markdown-style table tr:nth-child(2n) { background-color: var(--color-canvas-subtle); } markdown-style table img { background-color: transparent; vertical-align: middle; } markdown-style img[align=right] { padding-left: 20px; } markdown-style img[align=left] { padding-right: 20px; } markdown-style .emoji { max-width: none; vertical-align: text-top; background-color: transparent; } markdown-style span.frame { display: block; overflow: hidden; } markdown-style span.frame>span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0 0; overflow: hidden; border: 1px solid var(--color-border-default); } markdown-style span.frame span img { display: block; float: left; } markdown-style span.frame span span { display: block; padding: 5px 0 0; clear: both; color: var(--color-fg-default); } markdown-style span.align-center { display: block; overflow: hidden; clear: both; } markdown-style span.align-center>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: center; } markdown-style span.align-center span img { margin: 0 auto; text-align: center; } markdown-style span.align-right { display: block; overflow: hidden; clear: both; } markdown-style span.align-right>span { display: block; margin: 13px 0 0; overflow: hidden; text-align: right; } markdown-style span.align-right span img { margin: 0; text-align: right; } markdown-style span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; } markdown-style span.float-left span { margin: 13px 0 0; } markdown-style span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; } markdown-style span.float-right>span { display: block; margin: 13px auto 0; overflow: hidden; text-align: right; } markdown-style code, markdown-style tt { padding: .2em .4em; margin: 0; font-size: 85%; background-color: var(--color-neutral-muted); border-radius: 6px; } markdown-style code br, markdown-style tt br { display: none; } markdown-style del code { text-decoration: inherit; } markdown-style pre code { font-size: 100%; } markdown-style pre>code { padding: 0; margin: 0; word-break: normal; white-space: pre; background: transparent; border: 0; } markdown-style pre { position: relative; font-size: 85%; line-height: 1.45; background-color: var(--color-canvas-subtle); border-radius: 6px; } markdown-style pre code, markdown-style pre tt { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; } markdown-style pre > code { padding: 16px; overflow: auto; display: block; } markdown-style .csv-data td, markdown-style .csv-data th { padding: 5px; overflow: hidden; font-size: 12px; line-height: 1; text-align: left; white-space: nowrap; } markdown-style .csv-data .blob-num { padding: 10px 8px 9px; text-align: right; background: var(--color-canvas-default); border: 0; } markdown-style .csv-data tr { border-top: 0; } markdown-style .csv-data th { font-weight: 600; background: var(--color-canvas-subtle); border-top: 0; } markdown-style .footnotes { font-size: 12px; color: var(--color-fg-muted); border-top: 1px solid var(--color-border-default); } markdown-style .footnotes ol { padding-left: 16px; } markdown-style .footnotes li { position: relative; } markdown-style .footnotes li:target::before { position: absolute; top: -8px; right: -8px; bottom: -8px; left: -24px; pointer-events: none; content: ""; border: 2px solid var(--color-accent-emphasis); border-radius: 6px; } markdown-style .footnotes li:target { color: var(--color-fg-default); } markdown-style .footnotes .data-footnote-backref g-emoji { font-family: monospace; } markdown-style .task-list-item { list-style-type: none; } markdown-style .task-list-item label { font-weight: 400; } markdown-style .task-list-item.enabled label { cursor: pointer; } markdown-style .task-list-item+.task-list-item { margin-top: 3px; } markdown-style .task-list-item .handle { display: none; } markdown-style .task-list-item-checkbox, markdown-style input[type="checkbox"] { margin: 0 .2em .25em -1.6em; vertical-align: middle; } markdown-style .contains-task-list:dir(rtl) .task-list-item-checkbox, markdown-style .contains-task-list:dir(rtl) input[type="checkbox"] { margin: 0 -1.6em .25em .2em; } markdown-style ::-webkit-calendar-picker-indicator { filter: invert(50%); }
</style>
<slot></slot>
`;
class MarkdownStyle extends HTMLElement {
    constructor() {
        super();
        this.shadow = this.attachShadow({ mode: 'open' });
        this.shadow.appendChild(__TEMPLATE__.content.cloneNode(true));
        const style = Array.prototype.slice
            .call(this.shadow.children)
            .find((item) => item.tagName === 'STYLE');
        if (style) {
            const id = '__MARKDOWN_STYLE__';
            const findStyle = document.getElementById(id);
            if (!findStyle) {
                style.id = id;
                document.head.append(style);
            }
        }
    }
    get theme() {
        const value = this.getAttribute('theme');
        return value === null ? '' : value;
    }
    set theme(name) {
        this.setAttribute('theme', name);
    }
    connectedCallback() {
        if (!this.theme) {
            const { colorMode } = document.documentElement.dataset;
            this.theme = colorMode;
            const observer = new MutationObserver((mutationsList, observer) => {
                this.theme = document.documentElement.dataset.colorMode;
            });
            observer.observe(document.documentElement, { attributes: true });
            window.matchMedia('(prefers-color-scheme: light)').onchange = (event) => {
                this.theme = event.matches ? 'light' : 'dark';
            };
            window.matchMedia('(prefers-color-scheme: dark)').onchange = (event) => {
                this.theme = event.matches ? 'dark' : 'light';
            };
        }
    }
}
customElements.define('markdown-style', MarkdownStyle);</script><markdown-style style="max-width: 960px; margin: 0 auto 60px auto; padding: 8px;max-width: 960px;" class="markdown-style">
    <p><strong><code>TLP:CLEAR</code></strong></p>
    <h1 id="cisa-m365-security-configuration-baseline-for-microsoft-entra-id"><a class="anchor" aria-hidden="true" tabindex="-1" href="#cisa-m365-security-configuration-baseline-for-microsoft-entra-id"><span class="octicon octicon-link"></span></a>CISA M365 Security Configuration Baseline for Microsoft Entra ID</h1>
    <p>Microsoft Entra ID is a cloud-based identity and access control service that provides security and functional capabilities. This Secure Configuration Baseline (SCB) provides specific policies to help secure Microsoft Entra ID.</p>
    <p>The Secure Cloud Business Applications (SCuBA) project run by the Cybersecurity and Infrastructure Security Agency (CISA) provides guidance and capabilities to secure federal civilian executive branch (FCEB) agencies‚Äô cloud business application environments and protect federal information that is created, accessed, shared, and stored in those environments.</p>
    <p>The CISA SCuBA SCBs for M365 help secure federal information assets stored within M365 cloud business application environments through consistent, effective, and manageable security configurations. CISA created baselines tailored to the federal government‚Äôs threats and risk tolerance with the knowledge that every organization has different threat models and risk tolerance. Non-governmental organizations may also find value in applying these baselines to reduce risks.</p>
    <p>The information in this document is being provided ‚Äúas is‚Äù for INFORMATIONAL PURPOSES ONLY. CISA does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial entities or commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoritism by CISA. This document does not address, ensure compliance with, or supersede any law, regulation, or other authority. Entities are responsible for complying with any recordkeeping, privacy, and other laws that may apply to the use of technology. This document is not intended to, and does not, create any right or benefit for anyone against the United States, its departments, agencies, or entities, its officers, employees, or agents, or any other person.</p>
    <blockquote>
      <p>This document is marked TLP:CLEAR. Recipients may share this information without restriction. Information is subject to standard copyright rules. For more information on the Traffic Light Protocol, see <a href="https://www.cisa.gov/tlp">https://www.cisa.gov/tlp</a>.</p>
    </blockquote>
    <h2 id="license-compliance-and-copyright"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-compliance-and-copyright"><span class="octicon octicon-link"></span></a>License Compliance and Copyright</h2>
    <p>Portions of this document are adapted from documents in Microsoft‚Äôs <a href="https://github.com/MicrosoftDocs/microsoft-365-docs/blob/public/LICENSE">M365</a> and <a href="https://github.com/MicrosoftDocs/azure-docs/blob/main/LICENSE">Azure</a> GitHub repositories. The respective documents are subject to copyright and are adapted under the terms of the Creative Commons Attribution 4.0 International license. Sources are linked throughout this document. The United States government has adapted selections of these documents to develop innovative and scalable configuration standards to strengthen the security of widely used cloud-based software services.</p>
    <h2 id="assumptions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#assumptions"><span class="octicon octicon-link"></span></a>Assumptions</h2>
    <p>The <strong>License Requirements</strong> sections of this document assume the organization is using an <a href="https://www.microsoft.com/en-us/microsoft-365/compare-microsoft-365-enterprise-plans">M365 E3</a> or <a href="https://www.microsoft.com/en-us/microsoft-365/government">G3</a> license level at a minimum. Therefore, only licenses not included in E3/G3 are listed.</p>
    <p>Some of the policies in this baseline may link to Microsoft instruction pages which assume that an agency has created emergency access accounts in Microsoft Entra ID and <a href="https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-emergency-access#create-emergency-access-accounts">implemented strong security measures</a> to protect the credentials of those accounts.</p>
    <h2 id="key-terminology"><a class="anchor" aria-hidden="true" tabindex="-1" href="#key-terminology"><span class="octicon octicon-link"></span></a>Key Terminology</h2>
    <p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="https://datatracker.ietf.org/doc/html/rfc2119">RFC 2119</a>.</p>
    <p>The following are key terms and descriptions used in this document.</p>
    <p>
      <strong>Microsoft Entra ID hybrid</strong>: This term denotes the scenario
      when an organization has an on-premises Microsoft Windows Server Active Directory that contains the
      master user directory but federates access to the cloud M365
      Microsoft Entra ID tenant.
    </p>
    <p><strong>Resource Tenant &#x26; Home Tenant</strong>: In scenarios where guest users are involved the <strong>resource tenant</strong> hosts the M365 target resources that the guest user is accessing. The <strong>home tenant</strong> is the one that hosts the guest user's identity.</p>
    <h2 id="highly-privileged-roles"><a class="anchor" aria-hidden="true" tabindex="-1" href="#highly-privileged-roles"><span class="octicon octicon-link"></span></a>Highly Privileged Roles</h2>
    <p>This section provides a list of what CISA considers highly privileged <a href="https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference">built-in roles in Microsoft Entra ID</a>. This list is referenced in numerous baseline policies throughout this document. Agencies should consider this reference as a minimum list and can apply the respective baseline policies to additional Microsoft Entra ID roles as necessary.</p>
    <ul>
      <li>Global Administrator</li>
      <li>Privileged Role Administrator</li>
      <li>User Administrator</li>
      <li>SharePoint Administrator</li>
      <li>Exchange Administrator</li>
      <li>Hybrid Identity Administrator</li>
      <li>Application Administrator</li>
      <li>Cloud Application Administrator</li>
    </ul>
    <p>Throughout this document, this list of highly privileged roles is referenced in numerous baseline policies. Agencies should consider this list a foundational reference and apply respective baseline policies to additional Microsoft Entra ID roles as necessary.</p>
    <h2 id="conditional-access-policies"><a class="anchor" aria-hidden="true" tabindex="-1" href="#conditional-access-policies"><span class="octicon octicon-link"></span></a>Conditional Access Policies</h2>
    <p>Numerous policies in this baseline rely on Microsoft Entra ID Conditional Access. Conditional Access is a feature that allows administrators to limit access to resources using conditions such as user or group membership, device, IP location, and real-time risk detection. This section provides guidance and tools when implementing baseline policies which rely on Microsoft Entra ID Conditional Access.</p>
    <p>As described in Microsoft‚Äôs literature related to conditional access policies, CISA recommends initially setting a policy to <strong>Report-only</strong> when it is created and then performing thorough hands-on testing to help prevent unintended consequences before toggling the policy from <strong>Report-only</strong> to <strong>On</strong>. The policy will only be enforced when it is set to <strong>On</strong>. One tool that can assist with running test simulations is the <a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/what-if-tool">What If tool</a>. Microsoft also describes <a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-insights-reporting">Conditional Access insights and reporting</a> that can assist with testing.</p>
    <h1 id="baseline-policies"><a class="anchor" aria-hidden="true" tabindex="-1" href="#baseline-policies"><span class="octicon octicon-link"></span></a>Baseline Policies</h1>
    <h2 id="1-legacy-authentication"><a class="anchor" aria-hidden="true" tabindex="-1" href="#1-legacy-authentication"><span class="octicon octicon-link"></span></a>1. Legacy Authentication</h2>
    <p>This section provides policies that reduce security risks related to legacy authentication protocols that do not support multifactor authentication (MFA).</p>
    <h3 id="policies"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad11v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad11v1"><span class="octicon octicon-link"></span></a>MS.AAD.1.1v1</h4>
    <p>Legacy authentication SHALL be blocked.</p><!--Policy: MS.AAD.1.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> The security risk of allowing legacy authentication protocols is they do not support MFA. Blocking legacy protocols reduces the impact of user credential theft.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1110/">T1110: Brute Force</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1110/001/">T1110.001: Password Guessing</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/002/">T1110.002: Password Cracking</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/003/">T1110.003: Password Spraying</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-block-legacy">Common Conditional Access policy: Block legacy authentication</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/azure/security/fundamentals/steps-secure-identity">Five steps to securing your identity infrastructure</a></p>
      </li>
    </ul>
    <h3 id="license-requirements"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>N/A</li>
    </ul>
    <h3 id="implementation"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad11v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad11v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.1.1v1 Instructions</h4>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/block-legacy-authentication#identify-legacy-authentication-use">Determine if an agency‚Äôs existing applications use legacy authentication</a> before blocking legacy authentication across the entire application base.</p>
      </li>
      <li>
        <p>Create a <a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-block-legacy">Conditional Access policy to block legacy authentication</a>.</p>
      </li>
    </ul>
    <h2 id="2-risk-based-policies"><a class="anchor" aria-hidden="true" tabindex="-1" href="#2-risk-based-policies"><span class="octicon octicon-link"></span></a>2. Risk Based Policies</h2>
    <p>This section provides policies that reduce security risks related to potentially compromised user accounts. These policies combine Microsoft Entra ID Protection and Microsoft Entra ID Conditional Access. Microsoft Entra ID Protection uses numerous signals to detect the risk level for each user or sign-in and determine if an account may have been compromised.</p>
    <ul>
      <li>
        <p><em>Additional mitigations to reduce risks associated with the authentication of workload identities:</em> Although not covered in this baseline due to the need for an additional non-standard license, Microsoft provides support for mitigating risks related to workload identities (Microsoft Entra ID applications or service principals). Agencies should strongly consider implementing this feature because workload identities present many of the same risks as interactive user access and are commonly used in modern systems. CISA urges organizations to <a href="https://learn.microsoft.com/en-us/entra/identity/conditional-access/workload-identity">apply Conditional Access policies to workload identities</a>.</p>
      </li>
      <li>
        <p><em>Note:</em> In this section, the term <a href="https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-risks">"high risk"</a> denotes the risk level applied by the Microsoft Entra ID Protection service to a user account or sign-in event.</p>
      </li>
    </ul>
    <h3 id="policies-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-1"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad21v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad21v1"><span class="octicon octicon-link"></span></a>MS.AAD.2.1v1</h4>
    <p>Users detected as high risk SHALL be blocked.</p><!--Policy: MS.AAD.2.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Blocking high-risk users may prevent compromised accounts from accessing the tenant.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> Users identified as high risk by Microsoft Entra ID Identity Protection can be blocked from accessing the system via a Microsoft Entra ID Conditional Access policy. A high-risk user will be blocked until an administrator remediates their account.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad22v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad22v1"><span class="octicon octicon-link"></span></a>MS.AAD.2.2v1</h4>
    <p>A notification SHOULD be sent to the administrator when high-risk users are detected.</p><!--Policy: MS.AAD.2.2v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> Notification enables the admin to monitor the event and remediate the risk. This helps the organization proactively respond to cyber intrusions as they occur.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad23v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad23v1"><span class="octicon octicon-link"></span></a>MS.AAD.2.3v1</h4>
    <p>Sign-ins detected as high risk SHALL be blocked.</p><!--Policy: MS.AAD.2.3v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> This prevents compromised accounts from accessing the tenant.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-1"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-risks">What are risk detections?</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-simulate-risk">Simulating risk detections in Identity Protection</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-user-experience">User experiences with Microsoft Entra Identity Protection</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-1"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>Requires a Microsoft Entra ID P2 license</li>
    </ul>
    <h3 id="implementation-1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-1"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad21v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad21v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.2.1v1 Instructions</h4>
    <ol>
      <li>Create a conditional access policy blocking users categorized as high risk by the Identity Protection service. Configure the following policy settings in the new conditional access policy as per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Conditions > User risk > <b>High</b>

  Access controls > Grant > <b>Block Access</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > Cloud apps > All cloud apps

  Conditions > User risk > High

  Access controls > Grant > Block Access
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="msaad22v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad22v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.2.2v1 Instructions</h4>
    <ol>
      <li><a href="https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-configure-notifications#configure-users-at-risk-detected-alerts">Configure Microsoft Entra ID Protection to send a regularly monitored security mailbox email notification</a> when user accounts are determined to be high risk.</li>
    </ol>
    <h4 id="msaad23v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad23v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.2.3v1 Instructions</h4>
    <ol>
      <li>Create a Conditional Access policy blocking sign-ins determined high risk by the Identity Protection service. Configure the following policy settings in the new Conditional Access policy as per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Conditions > Sign-in risk > <b>High</b>

  Access controls > Grant > <b>Block Access</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > Cloud apps > All cloud apps

  Conditions > Sign-in risk > High

  Access controls > Grant > Block Access
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="3-strong-authentication-and-a-secure-registration-process"><a class="anchor" aria-hidden="true" tabindex="-1" href="#3-strong-authentication-and-a-secure-registration-process"><span class="octicon octicon-link"></span></a>3. Strong Authentication and a Secure Registration Process</h2>
    <p>This section provides policies that help reduce security risks related to user authentication and registration.</p>
    <p>Phishing-resistant MFA is required per <a href="https://www.whitehouse.gov/wp-content/uploads/2022/01/M-22-09.pdf">Office of Management and Budget Memorandum 22-09</a>, but for a variety of reasons, implementing it for all users may be challenging. This section provides additional backup security policies to mitigate risk associated with lesser forms of MFA. For example, Policy MS.AAD.3.2v1 below enforces MFA without stipulating the specific MFA method.</p>
    <p>
      <img src="/images/aad-mfa.png" alt="Weak MFA methods are SMS and Voice. Stronger MFA are Authenticator Push Notifications, Authenticator Phone Sign-in, Software Tokens OTP, and Hardware Tokens OTP. Strongest MFA methods are FIDO2 (preferred), Windows Hello (preferred), Microsoft Entra certificate-based authentication (preferred) and federated PIV card.">
    </p>
    <p>Figure 1: Depiction of MFA methods from weakest to strongest. <em>Adapted from <a href="https://learn.microsoft.com/en-us/entra/identity/authentication/concept-authentication-methods">Microsoft Page</a></em></p>
    <h3 id="policies-2"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-2"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad31v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad31v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.1v1</h4>
    <p>Phishing-resistant MFA SHALL be enforced for all users.</p>
    <p>The phishing-resistant methods <strong>Microsoft Entra ID certificate-based authentication (CBA)</strong>, <strong>FIDO2 Security Key</strong> and <strong>Windows Hello for Business</strong> are the recommended authentication options since they offer forms of MFA with the least weaknesses. For federal agencies, Microsoft Entra ID CBA supports federal PIV card authentication directly to Microsoft Entra ID.</p>
    <p>If on-premises PIV authentication and federation to Microsoft Entra ID is used, <a href="https://www.idmanagement.gov/implement/scl-windows/">enforce PIV logon via Microsoft Active Directory group policy</a>.</p><!--Policy: MS.AAD.3.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Weaker forms of MFA do not protect against sophisticated phishing attacks. By enforcing methods resistant to phishing, those risks are minimized.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1566/">T1566: Phishing</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1566/001/">T1566.001: Spearphishing Attachment</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1566/002/">T1566.002: Spearphishing Link</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad32v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad32v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.2v1</h4>
    <p>If phishing-resistant MFA has not been enforced, an alternative MFA method SHALL be enforced for all users.</p><!--Policy: MS.AAD.3.2v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> This is a stopgap security policy to help protect the tenant if phishing-resistant MFA has not been enforced. This policy requires MFA enforcement, thus reducing single-form authentication risk.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> If a conditional access policy has been created enforcing phishing-resistant MFA, then this policy is not necessary. This policy does not dictate the specific MFA method.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1110/">T1110: Brute Force</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1110/001/">T1110.001: Password Guessing</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/002/">T1110.002: Password Cracking</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/003/">T1110.003: Password Spraying</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad33v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad33v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.3v1</h4>
    <p>If phishing-resistant MFA has not been enforced and Microsoft Authenticator is enabled, it SHALL be configured to show login context information.</p><!--Policy: MS.AAD.3.3v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> This stopgap security policy helps protect the tenant when phishing-resistant MFA has not been enforced and Microsoft Authenticator is used. This policy helps improve the security of Microsoft Authenticator by showing user context information, which helps reduce MFA phishing compromises.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1110/">T1110: Brute Force</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1110/001/">T1110.001: Password Guessing</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/002/">T1110.002: Password Cracking</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1110/003/">T1110.003: Password Spraying</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad34v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad34v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.4v1</h4>
    <p>The Authentication Methods Manage Migration feature SHALL be set to Migration Complete.</p><!--Policy: MS.AAD.3.4v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> To disable the legacy authentication methods screen for the tenant, configure the Manage Migration feature to Migration Complete. The MFA and Self-Service Password Reset (SSPR) authentication methods are both managed from a central admin page, thereby reducing administrative complexity and potential security misconfigurations.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li>None</li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad35v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad35v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.5v1</h4>
    <p>The authentication methods SMS, Voice Call, and Email One-Time Passcode (OTP) SHALL be disabled.</p><!--Policy: MS.AAD.3.5v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> SMS, voice call, and email OTP are the weakest authenticators. This policy forces users to use stronger MFA methods.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> This policy is only applicable if the tenant has their Manage Migration feature set to Migration Complete.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1621/">T1621: Multi-Factor Authentication Request Generation</a></li>
          <li><a href="https://attack.mitre.org/techniques/T1566/">T1566: Phishing</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1566/002/">T1566.002: Spearphishing Link</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad36v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad36v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.6v1</h4>
    <p>Phishing-resistant MFA SHALL be required for highly privileged roles.</p><!--Policy: MS.AAD.3.6v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> This is a backup security policy to help protect privileged access to the tenant if the conditional access policy, which requires MFA for all users, is disabled or misconfigured.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> Refer to the Highly Privileged Roles section at the top of this document for a reference list of roles considered highly privileged.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1566/">T1566: Phishing</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1566/001/">T1566.001: Spearphishing Attachment</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1566/002/">T1566.002: Spearphishing Link</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad37v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad37v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.7v1</h4>
    <p>Managed devices SHOULD be required for authentication.</p><!--Policy: MS.AAD.3.7v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> The security risk of an adversary authenticating to the tenant from their own device is reduced by requiring a managed device to authenticate. Managed devices are under the provisioning and control of the agency. <a href="https://www.whitehouse.gov/wp-content/uploads/2022/01/M-22-09.pdf">OMB-22-09</a> states, "When authorizing users to access resources, agencies must consider at least one device-level signal alongside identity information about the authenticated user."</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad38v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad38v1"><span class="octicon octicon-link"></span></a>MS.AAD.3.8v1</h4>
    <p>Managed Devices SHOULD be required to register MFA.</p><!--Policy: MS.AAD.3.8v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> Reduce risk of an adversary using stolen user credentials and then registering their own MFA device to access the tenant by requiring a managed device provisioned and controlled by the agency to perform registration actions. This prevents the adversary from using their own unmanaged device to perform the registration.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T078/004/">T1078.004: Cloud Accounts</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/005/">T1098.005: Device Registration</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-2"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-2"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/authentication/concept-authentication-methods">What authentication and verification methods are available in Microsoft Entra ID?</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-mfa-additional-context#enable-additional-context-in-the-portal">How to use additional context in Microsoft Authenticator notifications - Authentication methods policy</a></p>
      </li>
      <li>
        <p><a href="https://www.whitehouse.gov/wp-content/uploads/2022/01/M-22-09.pdf">M-22-09 Federal Zero Trust Architecture Strategy</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/devices/how-to-hybrid-join">Configure Microsoft Entra hybrid join</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/devices/concept-directory-join">Microsoft Entra joined devices</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/mem/intune/enrollment/windows-enroll">Set up automatic enrollment for Windows devices (for Intune)</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-2"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-2"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>Policies related to managed devices require Microsoft Intune.</li>
    </ul>
    <h3 id="implementation-2"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-2"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad31v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad31v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.1v1 Instructions</h4>
    <ol>
      <li>Create a conditional access policy enforcing phishing-resistant MFA for all users. Configure the following policy settings in the new conditional access policy, per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Access controls > Grant > Grant Access > Require authentication strength > <b>Phishing-resistant MFA</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > Cloud apps > All cloud apps

  Access controls > Grant > Grant Access > Require authentication strength > Phishing-resistant MFA
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="msaad32v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad32v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.2v1 Instructions</h4>
    <ol>
      <li>If phishing-resistant MFA has not been enforced for all users yet, create a conditional access policy that enforces MFA but does not dictate MFA method. Configure the following policy settings in the new conditional access policy, per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Access controls > Grant > Grant Access > <b>Require multifactor authentication</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > Cloud apps > All cloud apps

  Access controls > Grant > Grant Access > Require multifactor authentication
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="msaad33v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad33v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.3v1 Instructions</h4>
    <p>If phishing-resistant MFA has not been deployed yet and Microsoft Authenticator is in use, configure Authenticator to display context information to users when they log in.</p>
    <ol>
      <li>In ** Microsoft Entra admin center**, click <strong>Security > Authentication methods > Microsoft Authenticator</strong>.</li>
      <li>Click the <strong>Configure</strong> tab.</li>
      <li>For <strong>Allow use of Microsoft Authenticator OTP</strong> select <em>No</em>.</li>
      <li>Under <strong>Show application name in push and passwordless notifications</strong> select <strong>Status > Enabled</strong> and <strong>Target > Include > All users</strong>.</li>
      <li>Under <strong>Show geographic location in push and passwordless notifications</strong> select <strong>Status > Enabled</strong> and <strong>Target > Include > All users</strong>.</li>
      <li>Select <strong>Save</strong></li>
    </ol>
    <h4 id="msaad34v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad34v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.4v1 Instructions</h4>
    <ol>
      <li>Go through the process of <a href="https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-authentication-methods-manage">How to migrate MFA and SSPR policy settings to the Authentication methods policy for Microsoft Entra ID</a>.</li>
      <li>Once ready to finish the migration, <a href="https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-authentication-methods-manage#finish-the-migration">set the <strong>Manage Migration</strong> option to <strong>Migration Complete</strong></a>.</li>
    </ol>
    <h4 id="msaad35v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad35v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.5v1 Instructions</h4>
    <ol>
      <li>In <strong>Microsoft Entra admin center</strong> , click <strong>Security > Authentication methods</strong></li>
      <li>Click on the <strong>SMS</strong>, <strong>Voice Call</strong>, and <strong>Email OTP</strong> authentication methods and disable each of them. Their statuses should be <strong>Enabled > No</strong> on the <strong>Authentication methods > Policies</strong> page.</li>
    </ol>
    <h4 id="msaad36v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad36v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.6v1 Instructions</h4>
    <ol>
      <li>Create a conditional access policy enforcing phishing-resistant MFA for highly privileged roles. Configure the following policy settings in the new conditional access policy, per the values below:</li>
    </ol>
    <pre>  Users > Include > Select users and groups > Directory roles > <b>select each of the roles listed in the Highly Privileged Roles section at the top of this document</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Access controls > Grant > Grant Access > Require authentication strength > <b>Phishing-resistant MFA</b>
<div onclick="copied(this)" data-code="  Users > Include > Select users and groups > Directory roles > select each of the roles listed in the Highly Privileged Roles section at the top of this document

  Target resources > Cloud apps > All cloud apps

  Access controls > Grant > Grant Access > Require authentication strength > Phishing-resistant MFA
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="msaad37v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad37v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.7v1 Instructions</h4>
    <ol>
      <li>Create a conditional access policy requiring a user's device to be either Microsoft Entra ID hybrid joined or compliant during authentication. Configure the following policy settings in the new conditional access policy, per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > Cloud apps > <b>All cloud apps</b>

  Access controls > Grant > Grant Access > <b>Require device to be marked as compliant</b> and <b>Require Microsoft Entra ID hybrid joined device</b> > For multiple controls > <b>Require one of the selected controls</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > Cloud apps > All cloud apps

  Access controls > Grant > Grant Access > Require device to be marked as compliant and Require Microsoft Entra ID hybrid joined device > For multiple controls > Require one of the selected controls
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h4 id="msaad38v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad38v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.3.8v1 Instructions</h4>
    <ol>
      <li>Create a conditional access policy requiring a user to be on a managed device when registering for MFA. Configure the following policy settings in the new conditional access policy, per the values below:</li>
    </ol>
    <pre>  Users > Include > <b>All users</b>

  Target resources > User actions > <b>Register security information</b>

  Access controls > Grant > Grant Access > <b>Require device to be marked as compliant</b> and <b>Require Microsoft Entra ID hybrid joined device</b> > For multiple controls > <b>Require one of the selected controls</b>
<div onclick="copied(this)" data-code="  Users > Include > All users

  Target resources > User actions > Register security information

  Access controls > Grant > Grant Access > Require device to be marked as compliant and Require Microsoft Entra ID hybrid joined device > For multiple controls > Require one of the selected controls
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
    <h2 id="4-centralized-log-collection"><a class="anchor" aria-hidden="true" tabindex="-1" href="#4-centralized-log-collection"><span class="octicon octicon-link"></span></a>4. Centralized Log Collection</h2>
    <p>This section provides policies to reduce security risks related to the lack of security logs, which hampers security visibility.</p>
    <h3 id="policies-3"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-3"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad41v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad41v1"><span class="octicon octicon-link"></span></a>MS.AAD.4.1v1</h4>
    <p>Security logs SHALL be sent to the agency's security operations center for monitoring.</p><!--Policy: MS.AAD.4.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> The security risk of not having visibility into cyber attacks is reduced by collecting logs in the agency‚Äôs centralized security detection infrastructure. This makes security events available for auditing, query, and incident response.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> The following Microsoft Entra ID logs (configured in diagnostic settings), are required: <code>AuditLogs, SignInLogs, RiskyUsers, UserRiskEvents, NonInteractiveUserSignInLogs, ServicePrincipalSignInLogs, ADFSSignInLogs, RiskyServicePrincipals, ServicePrincipalRiskEvents, EnrichedOffice365AuditLogs, MicrosoftGraphActivityLogs</code>. If managed identities are used for Azure resources, also send the <code>ManagedIdentitySignInLogs</code> log type. If the Microsoft Entra ID Provisioning Service is used to provision users to software-as-a-service (SaaS) apps or other systems, also send the <code>ProvisioningLogs</code> log type.</li>
      <li><em>Note:</em> Agencies can benefit from security detection capabilities offered by the CISA Cloud Log Aggregation Warehouse (CLAW) system. Agencies are urged to send the logs to CLAW. Contact CISA at <a href="mailto:cyberliason@cisa.dhs.gov">cyberliason@cisa.dhs.gov</a> to request integration instructions.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1562/">T1562: Impair Defenses</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1562/008/">T1562.008: Disable or Modify Cloud Logs</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-3"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-3"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://thecloudtechnologist.com/2021/10/15/everything-you-wanted-to-know-about-security-and-audit-logging-in-office-365/">Everything you wanted to know about Security and Audit Logging in Office 365</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/monitoring-health/concept-sign-ins">What are Microsoft Entra sign-in logs??</a></p>
      </li>
      <li>
        <p><a href="https://www.cisa.gov/sites/default/files/publications/NCPS%20Cloud%20Interface%20RA%20Volume%20One%20%282021-05-14%29.pdf">National Cybersecurity Protection System-Cloud Interface Reference Architecture Volume One: General Guidance</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-3"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-3"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>An Azure subscription may be required to send logs to an external system, such as the agency's Security Information and Event Management (SIEM).</li>
    </ul>
    <h3 id="implementation-3"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-3"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad41v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad41v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.4.1v1 Instructions</h4>
    <p>Follow the configuration instructions unique to the products and integration patterns at your organization to send the security logs to the security operations center for monitoring.</p>
    <h2 id="5-application-registration-and-consent"><a class="anchor" aria-hidden="true" tabindex="-1" href="#5-application-registration-and-consent"><span class="octicon octicon-link"></span></a>5. Application Registration and Consent</h2>
    <p>This section provides policies that help reduce security risk of malicious applications or service principals added to the tenant by non-privileged users. Malicious applications can perform many of the same operations as interactive users and can access data on behalf of compromised users. These policies apply to custom-developed applications and applications published by third-party vendors.</p>
    <h3 id="policies-4"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-4"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad51v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad51v1"><span class="octicon octicon-link"></span></a>MS.AAD.5.1v1</h4>
    <p>Only administrators SHALL be allowed to register applications.</p><!--Policy: MS.AAD.5.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Application access for the tenant presents a heightened security risk compared to interactive user access because applications are typically not subject to critical security protections, such as MFA policies. Reduce risk of unauthorized users installing malicious applications into the tenant by ensuring that only specific privileged users can register applications.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/001/">T1098.001: Additional Cloud Credentials</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad52v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad52v1"><span class="octicon octicon-link"></span></a>MS.AAD.5.2v1</h4>
    <p>Only administrators SHALL be allowed to consent to applications.</p><!--Policy: MS.AAD.5.2v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Limiting applications consent to only specific privileged users reduces risk of users giving insecure applications access to their data via <a href="https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-illicit-consent-grants?view=o365-worldwide">consent grant attacks</a>.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/001/">T1098.001: Additional Cloud Credentials</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad53v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad53v1"><span class="octicon octicon-link"></span></a>MS.AAD.5.3v1</h4>
    <p>An admin consent workflow SHALL be configured for applications.</p><!--Policy: MS.AAD.5.3v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Configuring an admin consent workflow reduces the risk of the previous policy by setting up a process for users to securely request access to applications necessary for business purposes. Administrators have the opportunity to review the permissions requested by new applications and approve or deny access based on a risk assessment.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/001/">T1098.001: Additional Cloud Credentials</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad54v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad54v1"><span class="octicon octicon-link"></span></a>MS.AAD.5.4v1</h4>
    <p>Group owners SHALL NOT be allowed to consent to applications.</p><!--Policy: MS.AAD.5.4v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> In M365, group owners and team owners can consent to applications accessing data in the tenant. By requiring consent requests to go through an approval workflow, risk of exposure to malicious applications is reduced.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/001/">T1098.001: Additional Cloud Credentials</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-4"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-4"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/ActiveDirectory/users-can-register-applications.html">Restrict Application Registration for Non-Privileged Users</a></p>
      </li>
      <li>
        <p><a href="https://www.trendmicro.com/cloudoneconformity/knowledge-base/azure/ActiveDirectory/users-can-consent-to-apps-accessing-company-data-on-their-behalf.html">Enforce Administrators to Provide Consent for Apps Before Use</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/configure-admin-consent-workflow">Configure the admin consent workflow</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-4"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-4"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>N/A</li>
    </ul>
    <h3 id="implementation-4"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-4"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad51v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad51v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.5.1v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong>, under <strong>Manage</strong>, select <strong>Users</strong>.</p>
      </li>
      <li>
        <p>Select <strong>User settings</strong>.</p>
      </li>
      <li>
        <p>For <strong>Users can register applications</strong>, select <strong>No</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h4 id="msaad52v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad52v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.5.2v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> under <strong>Manage</strong>, select <strong>Enterprise Applications</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Security</strong>, select <strong>Consent and permissions</strong>. Then select <strong>User Consent Settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>User consent for applications</strong>, select <strong>Do not allow user consent</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h4 id="msaad53v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad53v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.5.3v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> create a new Microsoft Entra ID Group that contains admin users responsible for reviewing and adjudicating application consent requests. Group members will be notified when users request consent for new applications.</p>
      </li>
      <li>
        <p>Then in <strong>Microsoft Entra admin center</strong> under <strong>Applications</strong>, select <strong>Enterprise Applications</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Security</strong>, select <strong>Consent and permissions</strong>. Then select <strong>Admin consent settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Admin consent requests</strong> > <strong>Users can request admin consent to apps they are unable to consent to</strong> select <strong>Yes</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Who can review admin consent requests</strong>, select <strong>+ Add groups</strong> and select the group responsible for reviewing and adjudicating app requests (created in step one above).</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h4 id="msaad54v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad54v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.5.4v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> under <strong>Applications</strong>, select <strong>Enterprise Applications</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Security</strong>, select <strong>Consent and permissions</strong>. Then select <strong>User Consent Settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Group owner consent for apps accessing data</strong>, select <strong>Do not allow group owner consent</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h2 id="6-passwords"><a class="anchor" aria-hidden="true" tabindex="-1" href="#6-passwords"><span class="octicon octicon-link"></span></a>6. Passwords</h2>
    <p>This section provides policies that reduce security risks associated with legacy password practices.</p>
    <h3 id="policies-5"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-5"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad61v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad61v1"><span class="octicon octicon-link"></span></a>MS.AAD.6.1v1</h4>
    <p>User passwords SHALL NOT expire.</p><!--Policy: MS.AAD.6.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> The National Institute of Standards and Technology (NIST), OMB, and Microsoft have published guidance indicating mandated periodic password changes make user accounts less secure. For example, OMB-22-09 states, "Password policies must not require use of special characters or regular rotation."</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li>None</li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-5"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-5"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/microsoft-365/admin/misc/password-policy-recommendations?view=o365-worldwide#password-expiration-requirements-for-users">Password expiration requirements for users</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/authentication/concept-password-ban-bad">Eliminate bad passwords using Microsoft Entra Password Protection</a></p>
      </li>
      <li>
        <p><a href="https://pages.nist.gov/800-63-3/sp800-63b.html">NIST Special Publication 800-63B - Digital Identity Guidelines</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-5"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-5"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>N/A</li>
    </ul>
    <h3 id="implementation-5"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-5"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad61v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad61v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.6.1v1 Instructions</h4>
    <ol>
      <li><a href="https://learn.microsoft.com/en-us/microsoft-365/admin/manage/set-password-expiration-policy?view=o365-worldwide#set-password-expiration-policy">Configure the <strong>Password expiration policy</strong> to <strong>Set passwords to never expire</strong></a>.</li>
    </ol>
    <h2 id="7-highly-privileged-user-access"><a class="anchor" aria-hidden="true" tabindex="-1" href="#7-highly-privileged-user-access"><span class="octicon octicon-link"></span></a>7. Highly Privileged User Access</h2>
    <p>This section provides policies that help reduce security risks related to the usage of <a href="#highly-privileged-roles">highly privileged Microsoft Entra ID built-in roles</a>. Privileged administrative users have access to operations that can undermine the security of the tenant by changing configurations and security policies. Special protections are necessary to secure this level of access.</p>
    <p>Some of the policy implementations in this section reference specific features of the Microsoft Entra ID Privileged Identity Management (PIM) service that provides Privileged Access Management (PAM) capabilities. As an alternative to Microsoft Entra ID PIM, third-party products and services with equivalent PAM capabilities can be leveraged.</p>
    <h3 id="policies-6"><a class="anchor" aria-hidden="true" tabindex="-1" href="#policies-6"><span class="octicon octicon-link"></span></a>Policies</h3>
    <h4 id="msaad71v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad71v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.1v1</h4>
    <p>A minimum of two users and a maximum of eight users SHALL be provisioned with the Global Administrator role.</p><!--Policy: MS.AAD.7.1v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> The Global Administrator role provides unfettered access to the tenant. Limiting the number of users with this level of access makes tenant compromise more challenging. Microsoft recommends fewer than five users in the Global Administrator role. However, additional user accounts, up to eight, may be necessary to support emergency access and some operational scenarios.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad72v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad72v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.2v1</h4>
    <p>Privileged users SHALL be provisioned with finer-grained roles instead of Global Administrator.</p><!--Policy: MS.AAD.7.2v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Many privileged administrative users do not need unfettered access to the tenant to perform their duties. By assigning them to roles based on least privilege, the risks associated with having their accounts compromised are reduced.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1651/">T1651: Cloud Administration Command</a></li>
          <li><a href="https://attack.mitre.org/techniques/T1136/">T1136: Create Account</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1136/003/">T1136.003: Cloud Account</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad73v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad73v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.3v1</h4>
    <p>Privileged users SHALL be provisioned cloud-only accounts separate from an on-premises directory or other federated identity providers.</p><!--Policy: MS.AAD.7.3v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> By provisioning cloud-only Microsoft Entra ID user accounts to privileged users, the risks associated with a compromise of on-premises federation infrastructure are reduced. It is more challenging for the adversary to pivot from the compromised environment to the cloud with privileged access.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1556/">T1556: Modify Authentication Process</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1556/007/">T1556.007: Hybrid Identity</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad74v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad74v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.4v1</h4>
    <p>Permanent active role assignments SHALL NOT be allowed for highly privileged roles.</p><!--Policy: MS.AAD.7.4v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Instead of giving users permanent assignments to privileged roles, provisioning access just in time lessens exposure if those accounts become compromised. In Microsoft Entra ID PIM or an alternative PAM system, just in time access can be provisioned by assigning users to roles as eligible instead of perpetually active.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> Exceptions to this policy are:
        <ul>
          <li>Emergency access accounts that need perpetual access to the tenant in the rare event of system degradation or other scenarios.</li>
          <li>Some types of service accounts that require a user account with privileged roles; since these accounts are used by software programs, they cannot perform role activation.</li>
        </ul>
      </li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad75v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad75v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.5v1</h4>
    <p>Provisioning users to highly privileged roles SHALL NOT occur outside of a PAM system.</p><!--Policy: MS.AAD.7.5v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Provisioning users to privileged roles within a PAM system enables enforcement of numerous privileged access policies and monitoring. If privileged users are assigned directly to roles in the M365 admin center or via PowerShell outside of the context of a PAM system, a significant set of critical security capabilities are bypassed.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1651/">T1651: Cloud Administration Command</a></li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad76v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad76v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.6v1</h4>
    <p>Activation of the Global Administrator role SHALL require approval.</p><!--Policy: MS.AAD.7.6v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Requiring approval for a user to activate Global Administrator, which provides unfettered access, makes it more challenging for an attacker to compromise the tenant with stolen credentials and it provides visibility of activities indicating a compromise is taking place.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad77v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad77v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.7v1</h4>
    <p>Eligible and Active highly privileged role assignments SHALL trigger an alert.</p><!--Policy: MS.AAD.7.7v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Closely monitor assignment of the highest privileged roles for signs of compromise. Send assignment alerts to enable the security monitoring team to detect compromise attempts.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad78v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad78v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.8v1</h4>
    <p>User activation of the Global Administrator role SHALL trigger an alert.</p><!--Policy: MS.AAD.7.8v1; Criticality: SHALL -->
    <ul>
      <li><em>Rationale:</em> Closely monitor activation of the Global Administrator role for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>Note:</em> It is recommended to prioritize user activation of Global Administrator as one of the most important events to monitor and respond to.</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad79v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad79v1"><span class="octicon octicon-link"></span></a>MS.AAD.7.9v1</h4>
    <p>User activation of other highly privileged roles SHOULD trigger an alert.</p><!--Policy: MS.AAD.7.9v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> Closely monitor activation of high-risk roles for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts. In some environments, activating privileged roles can generate a significant number of alerts.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1136/">T1136: Create Account</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1136/003/">T1136.003: Cloud Account</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-6"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-6"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/best-practices#5-limit-the-number-of-global-administrators-to-less-than-5">Limit number of Global Administrators to less than 5</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/azure/security/fundamentals/steps-secure-identity#implement-privilege-access-management">Implement Privilege Access Management</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-how-to-add-role-to-user">Assign Microsoft Entra roles in Privileged Identity Management</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/concept-pim-for-groups">Privileged Identity Management (PIM) for Groups</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-approval-workflow">Approve or deny requests for Microsoft Entra roles in Privileged Identity Management</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-management/pim-how-to-configure-security-alerts">Configure security alerts for Microsoft Entra roles in Privileged Identity Management</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-6"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-6"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>Microsoft Entra ID PIM requires a Microsoft Entra ID P2 license.</li>
    </ul>
    <h3 id="implementation-6"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-6"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <p>The following implementation instructions that reference the Microsoft Entra ID PIM service will vary if using a third-party PAM system instead.</p>
    <h4 id="msaad71v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad71v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.1v1 Instructions</h4>
    <p>When counting the number of users assigned to the Global Administrator role, count each user only once.</p>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> count the number of users assigned to the <strong>Global Administrator</strong> role. Count users that are assigned directly to the role and users assigned via group membership. If you have Microsoft Entra ID PIM, count both the <strong>Eligible assignments</strong> and <strong>Active assignments</strong>. If any of the groups assigned to Global Administrator are enrolled in PIM for Groups, also count the number of group members from the PIM for Groups portal <strong>Eligible</strong> assignments.</p>
      </li>
      <li>
        <p>Validate that there are a total of two to eight users assigned to the Global Administrator role.</p>
      </li>
    </ol>
    <h4 id="msaad72v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad72v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.2v1 Instructions</h4>
    <p>This policy is based on the ratio below:</p>
    <p><code>X = (Number of users assigned to the Global Administrator role) / (Number of users assigned to other highly privileged roles)</code></p>
    <ol>
      <li>
        <p>Follow the instructions for policy MS.AAD.7.1v1 above to get a count of users assigned to the Global Administrator role.</p>
      </li>
      <li>
        <p>Follow the instructions for policy MS.AAD.7.1v1 above but get a count of users assigned to the other highly privileged roles (not Global Administrator). If a user is assigned to both Global Administrator and other roles, only count that user for the Global Administrator assignment.</p>
      </li>
      <li>
        <p>Divide the value from step 2 from the value from step 1 to calculate X. If X is less than or equal to 1 then the tenant is compliant with the policy.</p>
      </li>
    </ol>
    <h4 id="msaad73v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad73v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.3v1 Instructions</h4>
    <ol>
      <li>
        <p>Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.</p>
      </li>
      <li>
        <p>Create a list of all the users assigned to the <strong>Global Administrator</strong> role. Include users that are assigned directly to the role and users assigned via group membership. If you have Microsoft Entra ID PIM, include both the <strong>Eligible assignments</strong> and <strong>Active assignments</strong>. If any of the groups assigned to Global Administrator are enrolled in PIM for Groups, also include group members from the PIM for Groups portal <strong>Eligible</strong> assignments.</p>
      </li>
      <li>
        <p>For each highly privileged user in the list, execute the Powershell code below but replace the <code>username@somedomain.com</code> with the principal name of the user who is specific to your environment. You can get the data value from the <strong>Principal name</strong> field displayed in the Microsoft Entra ID portal.</p>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">Connect-MgGraph
</span><span class="code-line line-number" line="2">Get-MgBetaUser -Filter "userPrincipalName eq 'username@somedomain.com'" | FL
</span></code><div onclick="copied(this)" data-code="Connect-MgGraph
Get-MgBetaUser -Filter &#x22;userPrincipalName eq &#x27;username@somedomain.com&#x27;&#x22; | FL
" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
      </li>
      <li>
        <p>Review the output field named <strong>OnPremisesImmutableId</strong>. If this field contains a data value, it means that the user is not cloud-only. If the user is not cloud-only, create a cloud-only account for that user, assign the user to their respective roles and then remove the account that is not cloud-only from Microsoft Entra ID.</p>
      </li>
    </ol>
    <h4 id="msaad74v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad74v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.4v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> select <strong>Roles and administrators</strong>. Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.</p>
      </li>
      <li>
        <p>Select the <strong>Global administrator role</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Manage</strong>, select <strong>Assignments</strong> and click the <strong>Active assignments</strong> tab.</p>
      </li>
      <li>
        <p>Verify there are no users or groups with a value of <strong>Permanent</strong> in the <strong>End time</strong> column. If there are any, recreate those assignments to have an expiration date using Microsoft Entra ID PIM or an alternative PAM system. If a group is identified and it is enrolled in PIM for Groups, see the exception cases below for details.</p>
      </li>
    </ol>
    <p>Exception cases:</p>
    <ul>
      <li>Emergency access accounts that require perpetual active assignment.</li>
      <li>Service accounts that require perpetual active assignment.</li>
      <li>If using PIM for Groups, a group that is enrolled in PIM is allowed to have a perpetual active assignment to a role because activation is handled by PIM for Groups.</li>
    </ul>
    <h4 id="msaad75v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad75v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.5v1 Instructions</h4>
    <ol>
      <li>
        <p>Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.</p>
      </li>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> select <strong>Roles and administrators</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>Global administrator role</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Manage</strong>, select <strong>Assignments</strong> and click the <strong>Active assignments</strong> tab.</p>
      </li>
      <li>
        <p>For each user or group listed, examine the value in the <strong>Start time</strong> column. If it contains a value of <strong>-</strong>, this indicates the respective user/group was assigned to that role outside of Microsoft Entra ID PIM. If the role was assigned outside of Microsoft Entra ID PIM, delete the assignment and recreate it using Microsoft Entra ID PIM.</p>
      </li>
    </ol>
    <h4 id="msaad76v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad76v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.6v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra Privileged Identity Management (PIM)</strong>, under <strong>Manage</strong>, select <strong>Microsoft Entra roles</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Manage</strong>, select <strong>Roles</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>Global Administrator</strong> role in the list.</p>
      </li>
      <li>
        <p>Click <strong>Settings</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Edit</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>Require approval to activate</strong> option.</p>
      </li>
      <li>
        <p>Click <strong>Update</strong>.</p>
      </li>
      <li>
        <p>Review the list of groups that are actively assigned to the <strong>Global Administrator</strong> role. If any of the groups are enrolled in PIM for Groups, then also apply the same configurations under step 2 above to each PIM group's <strong>Member</strong> settings.</p>
      </li>
    </ol>
    <h4 id="msaad77v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad77v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.7v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra Privileged Identity Management (PIM)</strong>, under <strong>Manage</strong>, select <strong>Microsoft Entra roles</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Manage</strong>, select <strong>Roles</strong>. Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.</p>
      </li>
      <li>
        <p>Click the <strong>Global Administrator</strong> role.</p>
      </li>
      <li>
        <p>Click <strong>Settings</strong> and then click <strong>Edit</strong>.</p>
      </li>
      <li>
        <p>Click the <strong>Notification</strong> tab.</p>
      </li>
      <li>
        <p>Under <strong>Send notifications when members are assigned as eligible to this role</strong>, in the <strong>Role assignment alert > Additional recipients</strong> textbox, enter the email address of the security monitoring mailbox configured to receive privileged role assignment alerts.</p>
      </li>
      <li>
        <p>Under <strong>Send notifications when members are assigned as active to this role</strong>, in the <strong>Role assignment alert > Additional recipients</strong> textbox, enter the email address of the security monitoring mailbox configured to receive privileged role assignment alerts.</p>
      </li>
      <li>
        <p>Click <strong>Update</strong>.</p>
      </li>
      <li>
        <p>For each of the highly privileged roles, if they have any PIM groups actively assigned to them, then also apply the same configurations per the steps above to each PIM group's <strong>Member</strong> settings.</p>
      </li>
    </ol>
    <h4 id="msaad78v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad78v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.8v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra Privileged Identity Management (PIM)</strong>, under <strong>Manage</strong>, select <strong>Microsoft Entra roles</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Manage</strong>, select <strong>Roles</strong>.</p>
      </li>
      <li>
        <p>Click the <strong>Global Administrator</strong> role.</p>
      </li>
      <li>
        <p>Click <strong>Settings</strong> and then click <strong>Edit</strong>.</p>
      </li>
      <li>
        <p>Click the <strong>Notification</strong> tab.</p>
      </li>
      <li>
        <p>Under <strong>Send notifications when eligible members activate this role</strong>, in the <strong>Role activation alert > Additional recipients</strong> textbox, enter the email address of the security monitoring mailbox configured to receive Global Administrator activation alerts.</p>
      </li>
      <li>
        <p>Click <strong>Update</strong>.</p>
      </li>
      <li>
        <p>If the Global Administrator role has any PIM groups actively assigned to it, then also apply the same configurations per the steps above to each PIM group's <strong>Member</strong> settings.</p>
      </li>
    </ol>
    <h4 id="msaad79v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad79v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.7.9v1 Instructions</h4>
    <ol>
      <li>
        <p>Follow the same instructions as MS.AAD.7.8v1 for each of the highly privileged roles (other than Global Administrator) but enter a security monitoring mailbox different from the one used to monitor Global Administrator activations.</p>
      </li>
      <li>
        <p>For each of the highly privileged roles, if they have any PIM groups actively assigned to them, then also apply the same configurations per step 1 to each PIM group's <strong>Member</strong> settings.</p>
      </li>
    </ol>
    <h2 id="8-guest-user-access"><a class="anchor" aria-hidden="true" tabindex="-1" href="#8-guest-user-access"><span class="octicon octicon-link"></span></a>8. Guest User Access</h2>
    <p>This section provides policies that help reduce security risks related to integrating M365 guest users. A guest user is a specific type of external user who belongs to a separate organization but can access files, meetings, Teams, and other data in the target tenant. It is common to invite guest users to a tenant for cross-agency collaboration purposes.</p>
    <h4 id="msaad81v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad81v1"><span class="octicon octicon-link"></span></a>MS.AAD.8.1v1</h4>
    <p>Guest users SHOULD have limited or restricted access to Microsoft Entra ID directory objects.</p><!--Policy: MS.AAD.8.1v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> Limiting the amount of object information available to guest users in the tenant, reduces malicious reconnaissance exposure, should a guest account become compromised or be created by an adversary.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1087/">T1087: Account Discovery</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1087/003/">T1087.003: Email Account</a></li>
              <li><a href="https://attack.mitre.org/techniques/T1087/004/">T1087.004: Cloud Account</a></li>
            </ul>
          </li>
          <li><a href="https://attack.mitre.org/techniques/T1526/">T1526: Cloud Service Discovery</a></li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad82v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad82v1"><span class="octicon octicon-link"></span></a>MS.AAD.8.2v1</h4>
    <p>Only users with the Guest Inviter role SHOULD be able to invite guest users.</p><!--Policy: MS.AAD.8.2v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> By only allowing an authorized group of individuals to invite external users to create accounts in the tenant, an agency can enforce a guest user account approval process, reducing the risk of unauthorized account creation.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1098/">T1098: Account Manipulation</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1098/003/">T1098.003: Additional Cloud Roles</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h4 id="msaad83v1"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad83v1"><span class="octicon octicon-link"></span></a>MS.AAD.8.3v1</h4>
    <p>Guest invites SHOULD only be allowed to specific external domains that have been authorized by the agency for legitimate business purposes.</p><!--Policy: MS.AAD.8.3v1; Criticality: SHOULD -->
    <ul>
      <li><em>Rationale:</em> Limiting which domains can be invited to create guest accounts in the tenant helps reduce the risk of users from unauthorized external organizations getting access.</li>
      <li><em>Last modified:</em> June 2023</li>
      <li><em>MITRE ATT&#x26;CK TTP Mapping:</em>
        <ul>
          <li><a href="https://attack.mitre.org/techniques/T1078/">T1078: Valid Accounts</a>
            <ul>
              <li><a href="https://attack.mitre.org/techniques/T1078/001/">T1078.001: Default Accounts</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
    <h3 id="resources-7"><a class="anchor" aria-hidden="true" tabindex="-1" href="#resources-7"><span class="octicon octicon-link"></span></a>Resources</h3>
    <ul>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/external-id/external-collaboration-settings-configure">Configure external collaboration settings</a></p>
      </li>
      <li>
        <p><a href="https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions#compare-member-and-guest-default-permissions">Compare member and guest default permissions</a></p>
      </li>
    </ul>
    <h3 id="license-requirements-7"><a class="anchor" aria-hidden="true" tabindex="-1" href="#license-requirements-7"><span class="octicon octicon-link"></span></a>License Requirements</h3>
    <ul>
      <li>N/A</li>
    </ul>
    <h3 id="implementation-7"><a class="anchor" aria-hidden="true" tabindex="-1" href="#implementation-7"><span class="octicon octicon-link"></span></a>Implementation</h3>
    <h4 id="msaad81v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad81v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.8.1v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> select <strong>External Identities > External collaboration settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Guest user access</strong>, select either <strong>Guest users have limited access to properties and memberships of directory objects</strong> or <strong>Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h4 id="msaad82v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad82v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.8.2v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> select <strong>External Identities > External collaboration settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Guest invite settings</strong>, select <strong>Only users assigned to specific admin roles can invite guest users</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h4 id="msaad83v1-instructions"><a class="anchor" aria-hidden="true" tabindex="-1" href="#msaad83v1-instructions"><span class="octicon octicon-link"></span></a>MS.AAD.8.3v1 Instructions</h4>
    <ol>
      <li>
        <p>In <strong>Microsoft Entra admin center</strong> select <strong>External Identities > External collaboration settings</strong>.</p>
      </li>
      <li>
        <p>Under <strong>Collaboration restrictions</strong>, select <strong>Allow invitations
only to the specified domains (most restrictive)</strong>.</p>
      </li>
      <li>
        <p>Select <strong>Target domains</strong> and enter the names of the external domains authorized by the agency for guest user access.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong>.</p>
      </li>
    </ol>
    <h1 id="appendix-a-microsoft-entra-id-hybrid-guidance"><a class="anchor" aria-hidden="true" tabindex="-1" href="#appendix-a-microsoft-entra-id-hybrid-guidance"><span class="octicon octicon-link"></span></a>Appendix A: Microsoft Entra ID hybrid Guidance</h1>
    <p>Most of this document does not focus on securing Microsoft Entra ID hybrid environments. CISA released a separate <a href="https://www.cisa.gov/sites/default/files/2023-03/csso-scuba-guidance_document-hybrid_identity_solutions_architecture-2023.03.22-final.pdf">Hybrid Identity Solutions Architecture</a> document addressing the unique implementation requirements of Microsoft Entra ID hybrid infrastructure.</p>
    <h1 id="appendix-b-cross-tenant-access-guidance"><a class="anchor" aria-hidden="true" tabindex="-1" href="#appendix-b-cross-tenant-access-guidance"><span class="octicon octicon-link"></span></a>Appendix B: Cross-tenant Access Guidance</h1>
    <p>Some of the conditional access policies contained in this security baseline, if implemented as described, will impact guest user access to a tenant. For example, the policies require users to perform MFA and originate from a managed device to gain access. These requirements are also enforced for guest users. For these policies to work effectively with guest users, both the home tenant (the one the guest user belongs to) and the resource tenant (the target tenant) may need to configure their Microsoft Entra ID cross-tenant access settings.</p>
    <p>Microsoft‚Äôs <a href="https://learn.microsoft.com/en-us/entra/external-id/authentication-conditional-access">Authentication and Conditional Access for External ID</a> provides an understanding of how MFA and device claims are passed from the home tenant to the resource tenant. To configure the inbound and outbound cross-tenant access settings in Microsoft Entra External ID, refer to Microsoft‚Äôs <a href="https://learn.microsoft.com/en-us/entra/external-id/cross-tenant-access-overview">Overview: Cross-tenant access with Microsoft Entra External ID</a>.</p>
    <p><strong><code>TLP:CLEAR</code></strong></p>
  <style>markdown-style pre .copied {
  display: flex;
  position: absolute;
  cursor: pointer;
  color: #a5afbb;
  top: 6px;
  right: 6px;
  border-radius: 5px;
  background: #82828226;
  padding: 6px;
  font-size: 12px;
  transition: all .3s;
}
markdown-style pre .copied:not(.active) {
  visibility: hidden;
}
markdown-style pre:hover .copied {
  visibility: visible;
}
markdown-style pre:hover .copied:hover {
  background: #4caf50;
  color: #fff;
}
markdown-style pre:hover .copied:active,
markdown-style pre .copied.active {
  background: #2e9b33;
  color: #fff;
}
markdown-style pre .copied .octicon-copy {
  display: block;
}
markdown-style pre .copied .octicon-check {
  display: none;
}
markdown-style pre .active .octicon-copy {
  display: none;
}
markdown-style pre .active .octicon-check {
  display: block;
}</style><script>/*! @uiw/copy-to-clipboard v1.0.12 | MIT (c) 2021 Kenny Wang | https://github.com/uiwjs/copy-to-clipboard.git */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).copyTextToClipboard=t()}(this,(function(){"use strict";return function(e,t){const o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style={position:"absolute",left:"-9999px"},document.body.appendChild(o);const n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);o.select();let c=!1;try{c=!!document.execCommand("copy")}catch(e){c=!1}document.body.removeChild(o),n&&document.getSelection&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n)),t&&t(c)}}));

function copied(target, str) {
  target.classList.add('active');
  copyTextToClipboard(target.dataset.code, function() {
    setTimeout(() => {
      target.classList.remove('active');
    }, 2000);
  });
}</script></markdown-style></body>
</html>
