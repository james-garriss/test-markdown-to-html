name: Convert to Text and HTML

on:
  push

jobs:
  convert:
    name: Convert
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
      - name: Prepare Output Directories
        run: |
          for d in baselines/*/; do
            echo $d
            mkdir -p pandoc/$d
          done
      - name: Convert to Text
        uses: docker://pandoc/core:3.5
        with:
          entrypoint: /bin/sh
          args: -c "find baselines -iname '*.md' -type f -exec sh -c 'pandoc ${0} --from markdown --to plain -o baselines/${0%.md}.txt' {} \;"
      - name: Install HTML converter
        run: npm i markdown-to-html-cli -g
      - name: Convert to HTML
        run: markdown-to-html --source baselines/aad.md --output baselines/aad.html
      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: output
          path: baselines
